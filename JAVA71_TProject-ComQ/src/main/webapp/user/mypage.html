<!DOCTYPE html>
<html lang="ko" >
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="">
  <title>Computer Curating System : myPage</title>

<!-- Bootstrap Core CSS -->
<link rel="stylesheet" href="/css/bootstrap.min.css" type="text/css">

<!-- Custom Fonts -->
<link rel='stylesheet' type='text/css'
  href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800'>
<link rel='stylesheet' type='text/css'
  href='http://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic,900,900italic'>
<link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css" type="text/css">

<!-- Plugin CSS -->
<link rel="stylesheet" href="/css/animate.min.css" type="text/css">
<link rel="stylesheet" href="/css/main.css" type="text/css">
<!-- Custom CSS -->
<link rel="stylesheet" href="/css/creative.css" type="text/css">

<link rel="stylesheet" href="/css/user.css" type="text/css">
<link rel="stylesheet" href="/css/mypage.css" type="text.css">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

<style>


 .myEstimate {
 	text-align : center;
 	overflow: hidden;
 }
 	.estimateList {
 		padding: 0 2em;
 	}
 	.estimateA {
 		color: white;
 	}
 	.estimateA:hover {
 		text-decoration: none;
 		color: white;
 	}
 	.estimate {
 	    padding: 1.2em;
 	    
 	}
 	.estimate img {
 		width: 100%;
 		height: auto;
 	}
 	
	@media (min-width:540px) and (max-width:768px) {
		.col-sm-4 { width: 50%; float:left; }
	}
  
</style>
</head>
<body>

  <nav id="mainNav" class="navbar navbar-default navbar-fixed-top">
    <div class="container-fluid">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed"
          data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
          <span class="sr-only">Toggle navigation</span> <span
            class="icon-bar"></span> <span class="icon-bar"></span> <span
            class="icon-bar"></span>
        </button>
        <a class="navbar-brand page-scroll" href="/">ComQ</a>
      </div>

      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse"
        id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav navbar-right">
          <li><a class="page-scroll" href="#about">About</a></li>
          <li><a class="page-scroll" href="#services">Services</a></li>
          <li><a class="page-scroll" href="#portfolio">Curating</a></li>
          <li><a class="page-scroll" href="#contact">Contact Us</a></li>
          <li id="login-a"><a id="login-ab" class="page-scroll" href="#"
            data-toggle="modal" data-target="#login-Modal">Login</a></li>
          <!-- <li id="logout-a"><a class="page-scroll" href="#">LogOuT</a></li> -->


          <li class="dropdown" id="usermenu_dropdown"><a href="#" id="user_email"
            data-toggle="dropdown" class="dropdown-toggle js-activated">
              <b class="caret"></b>
          </a>
            <ul class="dropdown-menu">
              <li><a href="/user/mypage.html">MyPage</a></li>
              <li><a href="" id="logout-a">logout</a></li>
            </ul></li>

          <!-- login-Modal -->
          <div class="modal fade" id="login-Modal" tabindex="-1"
            role="dialog" aria-labelledby="login-ModalLabel"
            aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal"
                    aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                  <h4 class="modal-title" id="login-ModalLabel">로그인</h4>
                </div>
                <div class="modal-body">

                  <form class="form-horizontal" id="login-form">
                    <div class="form-group">
                      <label for="user-mail" class="col-sm-2 control-label">Email</label>
                      <div class="col-sm-10">
                        <input type="email" class="form-control" id="user-email"
                          name="email" placeholder="이메일을 입력하세요.">
                      </div>
                    </div>
                    <div class="form-group">
                      <label for="user-pwd" class="col-sm-2 control-label">Password</label>
                      <div class="col-sm-10">
                        <input type="password" class="form-control" id="user-pwd"
                          name="pwd" placeholder="비밀번호 입력하세요.">
                      </div>
                    </div>
                    <div class="form-group">
                      <div class="col-sm-offset-2 col-sm-10">
                        <button type="submit" class="btn btn-default" id="btn-login">LOGIN</button>
                        <button id="join-btn" type="button" class="btn btn-default" data-toggle="modal" data-target="#join-Modal">SIGN IN</button>

                      </div>
                    </div>
                  </form>

                </div>
              </div>
            </div>
          </div>


          <!-- join-Modal -->
          <div class="modal fade" id="join-Modal" tabindex="-1" role="dialog"
            aria-labelledby="join-ModalLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal"
                    aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                  <h4 class="modal-title" id="join-ModalLabel">회원 가입</h4>
                </div>
                <div class="modal-body">

                  <form id="join-form" enctype="multipart/form-data"
                    action="/app/user/joinUser" method="POST">
                    <div class="form-group">
                      <label for="input-email" id="input-email-label">이메일주소 (필수)</label>
                      <p id="input-email-output" class="check-output"></p>
                      <input type="email" class="form-control" id="input-email"
                        placeholder="이메일을 입력하세요." name="email">

                    </div>
                    <div class="form-group">
                      <label for="input-pwd">비밀번호 (필수)</label>
                      <p id="pwd-check-output" class="check-output"></p> 
                      <input type="password" class="form-control" id="input-pwd" placeholder="비밀번호를 입력하세요." name="pwd">
                      <input type="password" class="form-control" id="input-pwd-check" placeholder="비밀번호를 다시 입력하세요.">
                    </div>
                    <div class="form-group">
                      <label for="porpic-upload">프로필 사진 (선택)</label>
                      <p id="propic-upload-output" class="check-output"></p>
                      <div id="propic-div">
                        <img id="propic-preview"
                          src="/img/icon/default-propic.png">
                      </div>
                      <input type="file" id="propic-upload" onchange="readURL(this)" class="btn btn-default" name="propic">
                    </div>
                    <div id="btn-join">
                      <button type="submit" class="btn btn-default">회원가입</button>
                    </div>
                  </form>

                </div>
              </div>
            </div>
          </div>

        </ul>
      </div>
      <!-- /.navbar-collapse -->
    </div>
    <!-- /.container-fluid -->
  </nav>

  <header>
    <div class="header-content">
      <div class="header-content-inner">
	  
  <div class="row">
  
    <div  class="col-sm-3" id="div_propic">
      <img id="propic" src="/propic/default-propic.png" alt="프로필 사진" class="img-rounded">
      <div id="userMail"><p id="user_data_email"></p></div>
    </div>	        
    <div class="col-sm-9" id="mypage_nav">
      <button type="button" class="btn btn-default btn-xl" id="update-start-btn">UPDATE your profile</button>
      <hr id="hr-line">
      <button type="button" class="btn btn-default btn-xl" id="esti-start-btn">View Your Estimates</button>
    </div>
    <div class="col-sm-9" id="div-update">
    
    
     <form id="update-form" enctype="multipart/form-data" action="/app/user/updateUser" method="POST">
       
       <div class="form-group">
         <label for="update-email" id="update-email-label">이메일주소 (필수)</label>
         <p id="update-email-output" class="check-output"></p>
         <input type="email" class="form-control" id="update-email" name="email">  
       </div>
       <div class="form-group">
         <label for="input-pwd">비밀번호 (필수)</label>
         <p id="update-pwd-check-output" class="check-output"></p> 
         <input type="password" class="form-control" id="update-pwd" placeholder="비밀번호를 입력하세요." name="pwd">
         <input type="password" class="form-control" id="update-pwd-check" placeholder="비밀번호를 다시 입력하세요.">
       </div>
       <div class="form-group">
         <label for="porpic-upload">프로필 사진 (선택)</label>
         <p id="update-propic-upload-output" class="check-output"></p>
         <input type="file" id="update-propic-upload" onchange="readUpdateURL(this)" class="btn btn-default" name="propic">
       </div>
       <button type="submit" class="btn btn-default" id="update-complete">변경하기</button>
       <button type="button" class="btn btn-default" id="backMove">돌아가기</button>
       <button type="button" class="btn btn-default" id="leave-btn">회원탈퇴</button>
     </form>
         
    </div>
    
  </div> 
    
      </div> <!-- header-content-inner -->
    </div> <!-- header-content -->
  </header>

<!-- Estimate 데이터 가져오기 -->
	<section class="bg-primary" id="about">
		<div class="myEstimate">
			<input type="hidden" name="startNo" value="1">
			<input type="hidden" name="endNo" value="6"> 
			<a href="javascript:getEstimateList();"
				class="btn btn-default btn-xl">My Estimate</a>
		</div>

		<div class="row estimateList">
		
		</div>
	</section>

	<!-- 의 Ajax -->
  <script>
  	function getEstimateList() {
   		$.ajax({
  			url : "/app/curator/userEstimateList",
  			data: {
  				startNo : $('[name=startNo]').val(),
   				endNo : $('[name=endNo]').val()
  			},
  			contentType: "application/x-www-form-urlencoded; charset=UTF-8",
  			timeout: 10000,
  			type: "POST",
  			dataType: "JSON",
  			beforeSend: function(xhr, settings) {
  			    /* 데이터 가져오기전에 로딩이미지 뿌려줌 */
  			  },
  			success : function(data) {
  				/* $('.estimateList').append(); */
  				$.each(data, function(index, item) {
						var space = /\+/g;
	  	  				var newData = JSON.parse(decodeURIComponent(data[index].replace(space, ' ')));
  						var divEstimate = $('<div class="col-sm-4 estimate"></div>'),
  							aTag = $('<a class="estimateA"></a>'),
  							imgTag = $('<img src="/img/portfolio/1.jpg" alt="사무용PC">'),
  							divTextPart = $('<div class="col-sm-8 col-lg-offset-2 text-center"></div>'),
  							estimateName = $('<h2 class="section-heading"></h2>'),
  							estiamteDate = $('<p></p>').text(newData.estDate);
  						
  						/* $(estimateDate).text(newData.estDate); */
  						/* $(estimateName).text(newData.estName); */
  						var imgsrc,
  							imgalt;
  						
  						switch (parseInt(newData.curId)) {
	  						case 1: imgsrc = "/img/portfolio/1.jpg"; imgalt = "사무용PC"; break;
	  						case 2: imgsrc = "/img/portfolio/2.jpg"; imgalt = "게임용PC"; break;
	  						case 3: imgsrc = "/img/portfolio/3.jpg"; imgalt = "디자인PC"; break;
	  						case 4: imgsrc = "/img/portfolio/4.jpg"; imgalt = "일체형PC"; break;
	  						case 5: imgsrc = "/img/portfolio/5.jpg"; imgalt = "조립PC"; break;
	  						case 6: imgsrc = "/img/portfolio/6.jpg"; imgalt = "PC부품"; break;
  						}
  						aTag = $(aTag).attr('href', 'javascript:getThisEstimateProdList('+ newData.estId +');');
  						imgTag = $(imgTag).attr('src', imgsrc).attr('alt',imgalt);
  						estimateName = $(estimateName).text(newData.estName);
  						divTextPart = $(divTextPart).append($(aTag).clone().append(estimateName)).append(estiamteDate);
  						divEstimate = $(divEstimate).append($(aTag).clone().append(imgTag)).append(divTextPart);
  						$('.estimateList').append(divEstimate);
				});
  			},
  			complete : function() {
  				/* 완료되면 로딩이미지 제거 */
  				$('[name=startNo]').val(parseInt($('[name=startNo]').val())+6);
  				$('[name=endNo]').val(parseInt($('[name=endNo]').val())+6);
  				$('.myEstimate').slideUp("fast");
  				
  				infinityScroll();
  				
  			},
  			error : function() {
  				
  			}
  		})
  	}; 
  	
  	/* unlimited scroll */
  	function infinityScroll() {
			$(window).on( "scroll", function() {
				if (($(window).scrollTop()) >= ($(document).height() - $(window).height())) {
					setTimeout(function() {
						$.ajax({
				  			url : "/app/curator/userEstimateList",
				  			data: {
				  				startNo : $('[name=startNo]').val(),
				   				endNo : $('[name=endNo]').val()
				  			},
				  			contentType: "application/x-www-form-urlencoded; charset=UTF-8",
				  			timeout: 10000,
				  			type: "POST",
				  			dataType: "JSON",
				  			beforeSend: function(xhr, settings) {
				  			    /* 데이터 가져오기전에 로딩이미지 뿌려줌 */
				  			  },
				  			success : function(data) {
				  				/* $('.estimateList').append(); */
				  				$.each(data, function(index, item) {
										var space = /\+/g;
					  	  				var newData = JSON.parse(decodeURIComponent(data[index].replace(space, ' ')));
				  						var divEstimate = $('<div class="col-sm-4 estimate"></div>'),
				  							aTag = $('<a class="estimateA"></a>'),
				  							imgTag = $('<img src="/img/portfolio/1.jpg" alt="사무용PC">'),
				  							divTextPart = $('<div class="col-sm-8 col-lg-offset-2 text-center"></div>'),
				  							estimateName = $('<h2 class="section-heading"></h2>'),
				  							estiamteDate = $('<p></p>').text(newData.estDate);
				  						
				  						/* $(estimateDate).text(newData.estDate); */
				  						/* $(estimateName).text(newData.estName); */
				  						var imgsrc,
				  							imgalt;
				  						
				  						switch (parseInt(newData.curId)) {
					  						case 1: imgsrc = "/img/portfolio/1.jpg"; imgalt = "사무용PC"; break;
					  						case 2: imgsrc = "/img/portfolio/2.jpg"; imgalt = "게임용PC"; break;
					  						case 3: imgsrc = "/img/portfolio/3.jpg"; imgalt = "디자인PC"; break;
					  						case 4: imgsrc = "/img/portfolio/4.jpg"; imgalt = "일체형PC"; break;
					  						case 5: imgsrc = "/img/portfolio/5.jpg"; imgalt = "조립PC"; break;
					  						case 6: imgsrc = "/img/portfolio/6.jpg"; imgalt = "PC부품"; break;
				  						}
				  						aTag = $(aTag).attr('href', 'javascript:getThisEstimateProdList('+ newData.estId +');').attr('name','searchEst');
				  						imgTag = $(imgTag).attr('src', imgsrc).attr('alt',imgalt);
				  						estimateName = $(estimateName).text(newData.estName);
				  						divTextPart = $(divTextPart).append($(aTag).clone().append(estimateName)).append(estiamteDate);
				  						divEstimate = $(divEstimate).append($(aTag).clone().append(imgTag)).append(divTextPart);
				  						$('.estimateList').append(divEstimate);
								});
				  			},
				  			complete : function() {
				  				/* 완료되면 로딩이미지 제거 */
				  				$('[name=startNo]').val(parseInt($('[name=startNo]').val())+6);
				  				$('[name=endNo]').val(parseInt($('[name=endNo]').val())+6);
				  			},
				  			error : function() {
				  				
				  			}
				  		})
					}, 800);
				}
			});
  	};
  	
  	/* get Estimate prodlist */
  	function getThisEstimateProdList(est_id){  		
	  	console.log('est_id 가져오는 중');
	  	console.log(est_id);

	  	$.ajax({
	  		url : '/app/curator/getEstimate?estId='+est_id,
	  		type: 'get',
	  		dataType : 'json',
	  		contentType: "application/x-www-form-urlencoded; charset=UTF-8",
  			timeout: 10000,
  			beforeSend : function() {
	  			
	  		},
	  		success : function(data) {
	  			$.each(data, function(index, item){
					var space = /\+/g;
					var newData = JSON.parse(decodeURIComponent(data[index].replace(space, ' ')));
		  			console.log('index >> ' + index);
					console.log(newData);
	  			})
					
	  		},
	  		error : function() {
	  			
	  		},
	  		complete : function() {
	  			
	  		}
	  	})
  	}
  	
  	
  	
  </script>
<!-- jquery -->
<script src="/js/jquery.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Plugin JavaScript -->
<script src="/js/jquery.easing.min.js"></script>
<script src="/js/jquery.fittext.js"></script>
<script src="/js/wow.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/creative.js"></script>
<script src="/js/user/join.js"></script>
<script src="/js/user/login.js"></script>
<script src="/js/user/mypage.js"></script>

<script src="/js/common/session.js"></script>
   
</body>
</html>